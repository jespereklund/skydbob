<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skyd Bob!</title>
</head>
<script>
    let canvas
    let bg
    let bob
    let score = 0
    let time = 0
    let gameState = "start" // start, game, done


    function init() {
        canvas = document.getElementById("canvas")
        ctx = canvas.getContext('2d')
        loadBg()
    }

    function loadBg() {
        bg = new Image()
        bg.onload = function() {
            loadBob()
        }
        bg.src = 'background.png'
    }

    function loadBob() {
        bob = new Image()
        bob.onload = function() {
            start()
        }
        bob.src = 'bob.png'
    }

    function start() {
        draw()
        window.setInterval(draw, 1000)
        canvas.addEventListener('click', (event) => { 
            const mouseX = event.x
            const mouseY = event.y
            //console.log("click", mouseX, mouseY)
            if (mouseX > 240 && mouseX < 439 && mouseY > 316 && mouseY < 389) {
                console.log("btn hit")
                if (gameState === "start") {
                    gameState = "game"
                }
            }
        })
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height)
        ctx.drawImage(bg, 0, 0, canvas.width, canvas.height, 0, 0, canvas.width, canvas.height)
        
        if (gameState === "start") {
            ctx.textAlign = 'center';
            ctx.strokeStyle = "black";
            ctx.beginPath();
            ctx.lineWidth = 15;
            ctx.roundRect(40, 40, 630, 460, 10);
            ctx.stroke();
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            ctx.fill();
            ctx.fillStyle = "black"

            ctx.font = "bold 30px courier";
            ctx.fillText("Hit Hideous Bob as many times", canvas.width / 2, 150)
            ctx.fillText("you can in one minute!", canvas.width / 2, 250)

            ctx.fillStyle = '#eeaa00';
            ctx.fillRect(canvas.width / 2 - 100, 330, 200, 75);
            ctx.fillStyle = '#001122';
            ctx.font = '25px arial';
            ctx.fillText('Start Game', canvas.width / 2, 376);          

        } else if (gameState === "game") {
            const bobX = Math.random() * 600 + 20
            const bobY = Math.random() * 180 + 160
            const bobScale = bobY / 200
            ctx.drawImage(bob, 0, 0, 49, 79, bobX, bobY, 49 * bobScale, 79 * bobScale)
        }
        ctx.textAlign = 'left';
        ctx.font = "bold 30px courier";
        ctx.fillText("Score: " + score, 30, 597)
        ctx.fillText("Time:" + ((time < 10) ? "  " : " ") + time + " Sec", 450, 597)
    }
    
</script>
<body onload="init()">
    <canvas id="canvas" width="710" height="632" ></canvas>
</body>
<style>
    body {
        margin:0;
        cursor: url('crosshair3.png'),auto;
    }
</style>
</html>